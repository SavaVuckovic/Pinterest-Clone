<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>{% block title %}{% endblock %}</title>
    <!-- Bootstrap Grid -->
    <link rel="stylesheet" href="/css/bootstrap-grid.min.css">
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css?family=Droid+Sans" rel="stylesheet">
    <!-- Custom CSS -->
    <link rel="stylesheet" href="/css/main.css">
    <!-- Additional Page-Specific CSS -->
    {% block stylesheets %}{% endblock %}
  </head>
  <body>

    <!-- Navbar -->
    <nav class="navbar">
      <a href="/"><img src="/images/logo.png" class="logo" alt="logo"></a>
      <ul class="navbar-left">
        <li><a href="#">Placeholder</a></li>
      </ul>
      {% if user %}
      <img class="user-img" src="{{ user.image }}" alt="user">
      {% endif %}
      <ul class="navbar-right">
        {% if not user %}
          <li><span id="login-btn">Login</span></li>
          <li><span id="register-btn">Register</span></li>
        {% endif %}
      </ul>
      <div class="clearfix"></div>
    </nav>

    {% if user %}
    <!-- Navbar dropdown -->
    <div class="navbar-dropdown">
      <ul>
        <li>dummy option</li>
        <li>dummy option</li>
        <li>dummy option</li>
        <li>dummy option</li>
        <li><a href="/auth/logout">logout</a></li>
      </ul>
    </div>
    {% endif %}

    <!-- Flash messages -->
    {% if success_msg %}
      <div class="flash flash-success">{{ success_msg }}</div>
    {% endif %}

    {% if error_msg %}
      <div class="flash flash-error">{{error_msg}}</div>
    {% endif %}

    <!-- Page Body -->
    {% block body %}{% endblock %}

    <script>
      // Hide flash messages if their content is empty
      // This is just a temporary workaround
      var success_msg = document.querySelector('.flash-success');
      var error_msg = document.querySelector('.flash-error');

      if(success_msg.innerHTML.length === 0) {
        success_msg.style.display = 'none';
      }

      if(error_msg.innerHTML.length === 0) {
        error_msg.style.display = 'none';
      }

    </script>

    {% if user %}
    <script>
      // show dropdown on user icon hover
      var userImg = document.querySelector('.user-img');
      var navDropdown = document.querySelector('.navbar-dropdown');

      userImg.addEventListener('click', toggleDropdown);

      function toggleDropdown() {
        console.log('ran')
        console.log(navDropdown.style)
        if(navDropdown.style.display === 'block') {
          navDropdown.style.display = 'none';
          console.log('this')
        } else if(navDropdown.style.display === '' || navDropdown.style.display === 'none') {
          navDropdown.style.display = 'block';
          console.log('or')
        }
      }
    </script>

    {% else %}
    <!-- Login Modal -->
    <div class="modal" id="login-modal">
      <div class="container">
        <div class="row justify-content-md-center">
          <div class="modal-content col-md-6">

            <div class="modal-header">
              <h2>Login</h2>
              <span class="modal-close" id="close-login">&times;</span>
            </div>
            <hr>
            <div class="modal-body">
              <form class="form" method="post" action="/auth/login">
                <input type="email" name="email" placeholder="Email">
                <input type="password" name="password" placeholder="Password">
                <button type="submit">Login</button>
              </form>

              <p>OR</p>

              <a href="/auth/google">Sign in with Google</a>
            </div>

          </div>
        </div>
      </div>
    </div>

    <!-- Register Modal -->
    <div class="modal" id="register-modal">
      <div class="container">
        <div class="row justify-content-md-center">
          <div class="modal-content col-md-6">

            <div class="modal-header">
              <h2>Register</h2>
              <span class="modal-close" id="close-register">&times;</span>
            </div>
            <hr>
            <div class="modal-body">
              <form class="form" method="post" action="/auth/register">
                <input type="text" name="username" placeholder="Username">
                <input type="email" name="email" placeholder="Email">
                <input type="password" name="password" placeholder="Password">
                <input type="password" name="password2" placeholder="Confirm Password">
                <button type="submit">Register</button>
              </form>
            </div>

          </div>
        </div>
      </div>
    </div>

    <script src="/js/auth_modals.js"></script>
    {% endif %}

  </body>
</html>
