<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>{% block title %}{% endblock %}</title>
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css?family=Droid+Sans|Pacifico" rel="stylesheet">
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
    <!-- Custom CSS -->
    <link rel="stylesheet" href="/css/main.css">
    <!-- Additional Page-Specific CSS -->
    {% block stylesheets %}{% endblock %}
  </head>
  <body>

    <!-- Navbar -->
    <nav class="navbar">
      <a href="/"><img src="/images/logo.png" class="logo" alt="logo"></a>
      <div class="navbar-left">
        <a href="/" id="brand">Pinterest Clone</a>
      </div>
      {% if user %}
        <div class="navbar-right">
          <div class="navbar-username">{{user.username}}</div>
          <img class="navbar-user-img" src="{{user.image}}" alt="user">
        </div>
      {% else %}
        <ul class="navbar-right">
          <li><span id="login-btn">Login</span></li>
          <li><span id="signup-btn">Sign Up</span></li>
        </ul>
      {% endif %}
      <div class="clearfix"></div>
    </nav>

    {% if user %}
    <div class="navbar-dropdown">
      <ul>
        <li><a href="/{{user.username}}">Profile</a></li>
        <li><a href="/auth/logout">logout</a></li>
      </ul>
    </div>
    {% endif %}

    <!-- Flash messages -->
    {% if success_msg %}
      <div class="flash flash-success">
        <div class="flash-success-text success-color">{{success_msg}}</div>
        <i class="flash-close success-color">&times;</i>
      </div>
    {% endif %}

    {% if error_msg %}
      <div class="flash flash-error">
        <div class="flash-error-text error-color">{{error_msg}}</div>
        <i class="flash-close error-color">&times;</i>
      </div>
    {% endif %}


    <!-- Page Body -->
    <div class="space-before-body"></div>
    {% block body %}{% endblock %}


    <script>
      // Hide flash messages if their content is empty
      var successMsg = document.querySelector('.flash-success');
      var errorMsg = document.querySelector('.flash-error');
      var successMsgText = document.querySelector('.flash-success-text');
      var errorMsgText = document.querySelector('.flash-error-text');
      var flashClose = document.querySelector('.flash-close');

      if(successMsgText.innerHTML.length === 0) {
        successMsg.style.display = 'none';
      }
      if(errorMsgText.innerHTML.length === 0) {
        errorMsg.style.display = 'none';
      }

      // Close flash messages
      flashClose.addEventListener('click', function() {
        successMsg.style.display = 'none';
        errorMsg.style.display = 'none';
      });
    </script>

    {% if user %}
    <script>
      // show/hide dropdown on user icon click
      var userImg = document.querySelector('.navbar-user-img');
      var navDropdown = document.querySelector('.navbar-dropdown');
      userImg.addEventListener('click', toggleDropdown);

      function toggleDropdown() {
        if(navDropdown.style.display === 'block') {
          navDropdown.style.display = 'none';
        } else if(navDropdown.style.display === '' || navDropdown.style.display === 'none') {
          navDropdown.style.display = 'block';
        }
      }
    </script>

    {% else %}
    <!-- Login Modal -->
    <div class="modal" id="login-modal">
      <div class="container">
        <div class="row justify-content-md-center">
          <div class="modal-content col-md-6">

            <div class="modal-header">
              <h2>Log in</h2>
              <span class="modal-close" id="close-login">&times;</span>
            </div>
            <hr>
            <div class="modal-body">
              <form class="form" method="post" action="/auth/login">
                <input type="email" name="email" placeholder="Email">
                <input type="password" name="password" placeholder="Password">
                <button type="submit">Log in</button>
              </form>


              <div class="or">or</div>
              <a href="/auth/google" id="google-button"><i class="fa fa-google" aria-hidden="true"></i>Log in with Google</a>
              <a href="/auth/twitter" id="twitter-button"><i class="fa fa-twitter" aria-hidden="true"></i>Log in in with Twitter</a>

            </div>

          </div>
        </div>
      </div>
    </div>

    <!-- SignUp Modal -->
    <div class="modal" id="signup-modal">
      <div class="container">
        <div class="row justify-content-md-center">
          <div class="modal-content col-md-6">

            <div class="modal-header">
              <h2>Sign Up</h2>
              <span class="modal-close" id="close-signup">&times;</span>
            </div>
            <hr>
            <div class="modal-body">
              <form class="form" method="post" action="/auth/signup">
                <input type="text" name="username" placeholder="Username">
                <input type="email" name="email" placeholder="Email">
                <input type="password" name="password" placeholder="Password">
                <input type="password" name="password2" placeholder="Confirm Password">
                <button type="submit">Sign Up</button>
              </form>
            </div>

          </div>
        </div>
      </div>
    </div>

    <script src="/js/auth_modals.js"></script>
    {% endif %}

  </body>
</html>
